-- -------------------------------------------------------------
-- 
-- File Name: D:\NIH3Repo\simulink_models\models\ur_ear_fpga\hdlsrc\ur_ear_fpga_sim\c1_chirp_filter\ur_ear_fpga_sim_c1_chirp_filter_c1_chirp_filter.vhd
-- 
-- Generated by MATLAB 9.9 and HDL Coder 3.17
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: ur_ear_fpga_sim_c1_chirp_filter_c1_chirp_filter
-- Source Path: c1_chirp_filter
-- Hierarchy Level: 5
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY ur_ear_fpga_sim_c1_chirp_filter_c1_chirp_filter IS
  PORT( clk                               :   IN    std_logic;
        reset                             :   IN    std_logic;
        enb_1_2048_0                      :   IN    std_logic;
        rsigma                            :   IN    std_logic_vector(31 DOWNTO 0);  -- single
        c1_chirp_in                       :   IN    std_logic_vector(31 DOWNTO 0);  -- single
        c1_chirp_filter_out               :   OUT   std_logic_vector(31 DOWNTO 0)  -- single
        );
END ur_ear_fpga_sim_c1_chirp_filter_c1_chirp_filter;


ARCHITECTURE rtl OF ur_ear_fpga_sim_c1_chirp_filter_c1_chirp_filter IS

  ATTRIBUTE multstyle : string;

  -- Component Declarations
  COMPONENT calc_c1_coefficients
    PORT( rsigma                          :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          p1_coef_1                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p1_coef_2                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p1_coef_3                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p1_coef_5                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p1_coef_6                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p3_coef_1                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p3_coef_2                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p3_coef_3                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p3_coef_5                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p3_coef_6                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p5_coef_1                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p5_coef_2                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p5_coef_3                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p5_coef_5                       :   OUT   std_logic_vector(31 DOWNTO 0);  -- single
          p5_coef_6                       :   OUT   std_logic_vector(31 DOWNTO 0)  -- single
          );
  END COMPONENT;

  COMPONENT iir_10th_order
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb_1_2048_0                    :   IN    std_logic;
          Sink_Data                       :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f1_c1                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f1_c2                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f1_c3                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f1_c5                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f1_c6                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f2_c1                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f2_c2                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f2_c3                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f2_c5                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f2_c6                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f3_c1                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f3_c2                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f3_c3                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f3_c5                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f3_c6                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f4_c1                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f4_c2                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f4_c3                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f4_c5                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f4_c6                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f5_c1                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f5_c2                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f5_c3                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f5_c5                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          f5_c6                           :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          Source_Data                     :   OUT   std_logic_vector(31 DOWNTO 0)  -- single
          );
  END COMPONENT;

  COMPONENT ur_ear_fpga_sim_c1_chirp_filter_Calculate_C1filterout
    PORT( C1filterouttmp                  :   IN    std_logic_vector(31 DOWNTO 0);  -- single
          C1filterout                     :   OUT   std_logic_vector(31 DOWNTO 0)  -- single
          );
  END COMPONENT;

  -- Component Configuration Statements
  FOR ALL : calc_c1_coefficients
    USE ENTITY work.ur_ear_fpga_sim_calc_c1_coefficients_calc_c1_coefficients(rtl);

  FOR ALL : iir_10th_order
    USE ENTITY work.ur_ear_fpga_sim_iir_10th_order_iir_10th_order(rtl);

  FOR ALL : ur_ear_fpga_sim_c1_chirp_filter_Calculate_C1filterout
    USE ENTITY work.ur_ear_fpga_sim_c1_chirp_filter_Calculate_C1filterout(rtl);

  -- Signals
  SIGNAL Model_out1                       : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out2                       : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out3                       : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out4                       : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out5                       : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out6                       : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out7                       : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out8                       : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out9                       : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out10                      : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out11                      : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out12                      : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out13                      : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out14                      : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Model_out15                      : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL c1filterouttmp                   : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL out_rsvd                         : std_logic_vector(31 DOWNTO 0);  -- ufix32

BEGIN
  -- Calculate C1 Filter Output
  -- - Scale the output by norm_gain/4
  -- - Scale the output by cihc
  -- 
  -- Get C1 Coefficients
  -- 
  -- Input: Pole-Shifting Feedback Parameter (rsigma)
  -- 		   
  -- Outputs: C1 Coefficients 			 
  -- 
  -- - Consists of various calculations to shift continuous-time pole locations according to rsigma feedback, then apply 
  -- a bilinear transformation to bring the poles to the digital space before finding the coefficients for the C1 filter
  -- 
  -- C1 Chirp Filter:
  -- 
  -- Inputs: ME Filtered Signal (meout)
  -- 		   C1 Coefficients 
  -- 		   
  -- Output: C1 Filtered Signal (c1filterout)
  -- 
  -- - 10th Order IIR Bandpass Filter
  -- 
  -- - Coefficients are determined in previous Get C1 	    	  Coefficients block

  u_Model : calc_c1_coefficients
    PORT MAP( rsigma => rsigma,  -- single
              p1_coef_1 => Model_out1,  -- single
              p1_coef_2 => Model_out2,  -- single
              p1_coef_3 => Model_out3,  -- single
              p1_coef_5 => Model_out4,  -- single
              p1_coef_6 => Model_out5,  -- single
              p3_coef_1 => Model_out6,  -- single
              p3_coef_2 => Model_out7,  -- single
              p3_coef_3 => Model_out8,  -- single
              p3_coef_5 => Model_out9,  -- single
              p3_coef_6 => Model_out10,  -- single
              p5_coef_1 => Model_out11,  -- single
              p5_coef_2 => Model_out12,  -- single
              p5_coef_3 => Model_out13,  -- single
              p5_coef_5 => Model_out14,  -- single
              p5_coef_6 => Model_out15  -- single
              );

  u_alpha10th_Order_IIR_Filter : iir_10th_order
    PORT MAP( clk => clk,
              reset => reset,
              enb_1_2048_0 => enb_1_2048_0,
              Sink_Data => c1_chirp_in,  -- single
              f1_c1 => Model_out1,  -- single
              f1_c2 => Model_out2,  -- single
              f1_c3 => Model_out3,  -- single
              f1_c5 => Model_out4,  -- single
              f1_c6 => Model_out5,  -- single
              f2_c1 => Model_out6,  -- single
              f2_c2 => Model_out7,  -- single
              f2_c3 => Model_out8,  -- single
              f2_c5 => Model_out9,  -- single
              f2_c6 => Model_out10,  -- single
              f3_c1 => Model_out11,  -- single
              f3_c2 => Model_out12,  -- single
              f3_c3 => Model_out13,  -- single
              f3_c5 => Model_out14,  -- single
              f3_c6 => Model_out15,  -- single
              f4_c1 => Model_out1,  -- single
              f4_c2 => Model_out2,  -- single
              f4_c3 => Model_out3,  -- single
              f4_c5 => Model_out4,  -- single
              f4_c6 => Model_out5,  -- single
              f5_c1 => Model_out11,  -- single
              f5_c2 => Model_out12,  -- single
              f5_c3 => Model_out13,  -- single
              f5_c5 => Model_out14,  -- single
              f5_c6 => Model_out15,  -- single
              Source_Data => c1filterouttmp  -- single
              );

  u_Calculate_C1filterout : ur_ear_fpga_sim_c1_chirp_filter_Calculate_C1filterout
    PORT MAP( C1filterouttmp => c1filterouttmp,  -- single
              C1filterout => out_rsvd  -- single
              );

  c1_chirp_filter_out <= out_rsvd;

END rtl;

